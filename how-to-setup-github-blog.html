<!DOCTYPE html>
<html lang="cn"
>
<head>
    <title>github 博客搭建过程 - Tommy de blog</title>
    <!-- Using the latest rendering mode for IE -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">



<link rel="canonical" href="http://tommyu.github.io/how-to-setup-github-blog.html">

        <meta name="author" content="Tommy" />
        <meta name="keywords" content="github" />
        <meta name="description" content="如何搭建github博客" />

        <meta property="og:site_name" content="Tommy de blog" />
        <meta property="og:type" content="article"/>
        <meta property="og:title" content="github 博客搭建过程"/>
        <meta property="og:url" content="http://tommyu.github.io/how-to-setup-github-blog.html"/>
        <meta property="og:description" content="如何搭建github博客"/>
        <meta property="article:published_time" content="2016-01-05" />
            <meta property="article:section" content="博客" />
            <meta property="article:tag" content="github" />
            <meta property="article:author" content="Tommy" />


    <!-- Bootstrap -->
        <link rel="stylesheet" href="http://tommyu.github.io/theme/css/bootstrap.min.css" type="text/css"/>
    <link href="http://tommyu.github.io/theme/css/font-awesome.min.css" rel="stylesheet">

    <link href="http://tommyu.github.io/theme/css/pygments/native.css" rel="stylesheet">
    <link href="http://tommyu.github.io/theme/tipuesearch/tipuesearch.css" rel="stylesheet">
    <link rel="stylesheet" href="http://tommyu.github.io/theme/css/style.css" type="text/css"/>

        <link href="http://tommyu.github.io/feeds/all.atom.xml" type="application/atom+xml" rel="alternate"
              title="Tommy de blog ATOM Feed"/>
    <!-- Google Analytics -->
    <script type="text/javascript">
        /*
        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-72127273-1']);
        _gaq.push(['_trackPageview']);

        (function () {
            var ga = document.createElement('script');
            ga.type = 'text/javascript';
            ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(ga, s);
        })();
*///old script
          (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
          (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
          })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

          ga('create', 'UA-72127273-1', 'auto');
          ga('send', 'pageview');

    </script>
    <!-- End Google Analytics Code -->
</head>
<body>

<div class="navbar navbar-default navbar-fixed-top" role="navigation">
	<div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a href="http://tommyu.github.io/" class="navbar-brand">
Tommy de blog            </a>
        </div>
        <div class="collapse navbar-collapse navbar-ex1-collapse">
            <ul class="nav navbar-nav">
                        <li class="active">
                            <a href="http://tommyu.github.io/category/bo-ke.html">博客</a>
                        </li>
            </ul>
            <ul class="nav navbar-nav navbar-right">
              <li><span>
                <form class="navbar-search" action="/search.html">
                  <input type="text" class="search-query" placeholder="Search" name="q" id="tipue_search_input" required>
                </form></span>
              </li>
              <li><a href="http://tommyu.github.io/archives.html"><i class="fa fa-th-list"></i><span class="icon-label">Archives</span></a></li>
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
</div> <!-- /.navbar -->
<!-- Banner -->
<!-- End Banner -->
<div class="container">
    <div class="row">
        <div class="col-sm-9">

    <section id="content">
        <article>
            <header class="page-header">
                <h1>
                    <a href="http://tommyu.github.io/how-to-setup-github-blog.html"
                       rel="bookmark"
                       title="Permalink to github 博客搭建过程">
                        github 博客搭建过程
                    </a>
                </h1>
            </header>
            <div class="entry-content">
                <div class="panel">
                    <div class="panel-body">
<footer class="post-info">
    <span class="label label-default">Date</span>
    <span class="published">
        <i class="fa fa-calendar"></i><time datetime="2016-01-05T20:20:00+08:00"> Tue 05 January 2016</time>
    </span>



<span class="label label-default">Tags</span>
	<a href="http://tommyu.github.io/tag/github.html">github</a>
    
</footer><!-- /.post-info -->                    </div>
                </div>
                <h1>准备工作</h1>
<h2>github帐号</h2>
<p>注册帐号， 然后依照这个<a href="https://pages.github.com/">指引</a>创建一个新的仓库，注意命名（<em>username</em>.github.io）;</p>
<h2>pelican</h2>
<p>这是一个基于python2.7(及以上)的静态页生成工具。注意，是静态页。github博客貌似只支持静态页。</p>
<div class="highlight"><pre>pip install pelican
pip install markdown
</pre></div>


<p>创建网站路径，并初始化</p>
<div class="highlight"><pre>mkdir my_blog
cd my_blog
pelican-quickstart
</pre></div>


<p>这样子就会在my_blog路径下敏初始化网站的静态页面结构（初始版），结构如下： </p>
<div class="highlight"><pre>├── content  
├── develop_server.sh  
├── fabfile.py  
├── Makefile  
├── output  
├── pelicanconf.py  
└── publishconf.py  
</pre></div>


<p>注意，在生成向导中选择好自己的github域名，即:What is your URL prefix? (see above example; <strong>no trailing slash</strong>) http://<em>username</em>.github.io 。
同时： Do you want to upload your website using GitHub Pages? (y/N) Y</p>
<p>pelicanconf.py为配置文件。<br />
content为markdown文件所存放的路径。<br />
output为实际生成静态html项目的路径。  </p>
<h2>pelican-themes</h2>
<p>pelican搭配使用的主题，大多基于bootstrap进行一定的定制，可以根据喜好选择<a href="http://www.pelicanthemes.com/">相应的风格</a>.  </p>
<p><strong>下载并注册主题</strong>  </p>
<div class="highlight"><pre>cd ../
git clone https://github.com/getpelican/pelican-themes.git
cd pelican-themes
pelican-themes -i pelican-bootstrap3
</pre></div>


<p>启用主题，编辑上面的pelicanconf.py文件， 添加以下代码</p>
<div class="highlight"><pre>THEME=&#39;pelican-bootstrap3&#39;
</pre></div>


<h1>创建第一个页面</h1>
<div class="highlight"><pre>cd ../my_blog/content
vi hello.md
</pre></div>


<p>添加以下代码：</p>
<div class="highlight"><pre><span class="n">Title</span><span class="o">:</span> <span class="n">hello</span> <span class="n">world</span>
<span class="n">Date</span><span class="o">:</span> <span class="mi">2015</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">03</span> <span class="mi">10</span><span class="o">:</span><span class="mi">20</span>
<span class="n">Category</span><span class="o">:</span> <span class="n">Markdown</span>
<span class="n">Tags</span><span class="o">:</span> <span class="n">Markdown</span>
<span class="n">Slug</span><span class="o">:</span> <span class="n">my</span><span class="o">-</span><span class="kd">super</span><span class="o">-</span><span class="n">post</span>
<span class="n">Authors</span><span class="o">:</span> <span class="n">your</span> <span class="n">name</span>
<span class="n">Summary</span><span class="o">:</span> <span class="n">pelican</span> <span class="n">markdown</span> <span class="n">demo</span>
<span class="err">#</span><span class="n">hello</span> <span class="n">world</span>
</pre></div>


<p>保存，退出编辑。</p>
<p>执行以下指令生成html,并运行本地的服务（可以在http://localhost:8000查看效果）</p>
<div class="highlight"><pre>cd ../
pelican content/
cd output
python -m pelican.server
</pre></div>


<h1>上传代码到github对应的仓库</h1>
<p>下载仓库代码(注意username的替换）</p>
<div class="highlight"><pre>git clone git@github.com:username/username.github.io.git
</pre></div>


<p>在生成html后， output目录结构（只到3层），如下：  </p>
<div class="highlight"><pre>├── output  
│   ├── archives.html  
│   ├── author  
│   │   └── your-name.html  
│   ├── authors.html  
│   ├── categories.html  
│   ├── category  
│   │   └── markdown.html  
│   ├── index.html  
│   ├── my-super-post.html  
│   ├── tag  
│   │   └── markdown.html  
│   ├── tags.html  
│   └── theme  
│       ├── css  
│       ├── fonts  
│       ├── js  
│       └── tipuesearch  
</pre></div>


<p>将output目录下的文件全部拷贝到本地的username.github.io 路径  </p>
<div class="highlight"><pre>cp -R output/*  username.github.io/
cd username.github.io/
git add .
git commit -a -m &#39;init&#39;
git push -u origin master
</pre></div>


<p>打开地址： http://username.github.io 查看效果。  </p>
<h1>利用MakeFile一键部署</h1>
<p>生成html，拷贝到git本地目录，然后git commit可以写脚本完成。然而在pelican这里有一个现成的MakeFile文件可以用。
修改下MakeFile，我的demo如下：
publish段：增加了cp指令一行，即将生成的html拷贝到本地git路径下。</p>
<div class="highlight"><pre><span class="nf">publish</span><span class="o">:</span>
        <span class="k">$(</span>PELICAN<span class="k">)</span> <span class="k">$(</span>INPUTDIR<span class="k">)</span> -o <span class="k">$(</span>OUTPUTDIR<span class="k">)</span> -s <span class="k">$(</span>PUBLISHCONF<span class="k">)</span> <span class="k">$(</span>PELICANOPTS<span class="k">)</span>
        cp -R <span class="k">$(</span>OUTPUTDIR<span class="k">)</span>/* <span class="k">$(</span>GIT_LOCAL_DIR<span class="k">)</span> 
</pre></div>


<p>github段:没用ghp-import指令，懒得安装这个多余的包。作为弥补，修改了publish段，如上。同时增加cd到git路径指令。</p>
<div class="highlight"><pre><span class="n">github</span><span class="p">:</span> <span class="n">publish</span>
        <span class="c">#ghp-import -m &quot;Generate Pelican site&quot; -b $(GITHUB_PAGES_BRANCH) $(OUTPUTDIR)</span>
        <span class="n">cd</span> <span class="err">$</span><span class="p">(</span><span class="n">GIT_LOCAL_DIR</span><span class="p">)</span><span class="o">&amp;&amp;</span><span class="n">git</span> <span class="n">add</span> <span class="o">.&amp;&amp;</span><span class="n">git</span> <span class="n">commit</span> <span class="o">-</span><span class="n">a</span> <span class="o">-</span><span class="n">m</span> <span class="s">&#39;+&#39;</span><span class="o">&amp;&amp;</span><span class="n">git</span> <span class="n">push</span> <span class="n">origin</span> <span class="err">$</span><span class="p">(</span><span class="n">GITHUB_PAGES_BRANCH</span><span class="p">)</span>
</pre></div>


<p>然后用指令make github即可部署。<br />
这样以后可以专注于写作。  </p>
<h1>关于搜索功能</h1>
<p>由于是静态站，所以搜索的实现落在了客户端。<br />
思路有不外乎：<br />
1. 解析index.html页面并操作dom元素<br />
2. 利用插件生成xml/json格式的sitemap，然后ajax请求这些资源并解析，渲染页面。  </p>
<p>我的实现方式是2，利用插件tipue_json在生成html时附带生成一个json文件。<br />
拷贝index.html页，命名为search.html，做少量修改（略）, 然后在里面加入下面这段代码：</p>
<div class="highlight"><pre><span class="nt">&lt;script</span> <span class="na">type=</span><span class="s">&quot;text/javascript&quot;</span><span class="nt">&gt;</span>
$(function(){
        do_search();
});

function getParameterByName(name) {
    name = name.replace(/[\[]/, &quot;\\[&quot;).replace(/[\]]/, &quot;\\]&quot;);
    var regex = new RegExp(&quot;[\\?<span class="err">&amp;</span>]&quot; + name + &quot;=([^<span class="err">&amp;</span>#]*)&quot;),
        results = regex.exec(location.search);
    return results === null ? &quot;&quot; : decodeURIComponent(results[1].replace(/\+/g, &quot; &quot;));
}

function do_search(){
        var result_tmplate=&quot;<span class="nt">&lt;article&gt;&lt;h2&gt;&lt;a</span> <span class="na">href=</span><span class="s">&#39;</span><span class="cp">{{</span><span class="nv">url</span><span class="cp">}}</span><span class="s">&#39;</span><span class="nt">&gt;</span><span class="cp">{{</span><span class="nv">title</span><span class="cp">}}</span><span class="nt">&lt;/a&gt;&lt;/h2&gt;&lt;/article&gt;</span>&quot;;
        var search_target = getParameterByName(&#39;q&#39;);
        var found_something=false;
        $(&quot;#tipue_search_input&quot;).val(search_target);
        $.ajax({
          dataType: &quot;json&quot;,
          url: &quot;/tipuesearch_content.json&quot;,
          success: function(data){
                console.log(data);

                for(var i=0;i<span class="nt">&lt;data.pages.length</span><span class="err">;i++)</span>
                <span class="err">{</span>
                        <span class="err">if(data.pages[i].title.indexOf(search_target)!=-1)</span>
                        <span class="err">{</span>
                                <span class="err">var</span> <span class="na">result_html =</span> <span class="s">result_tmplate.replace(&quot;</span><span class="cp">{{</span><span class="nv">title</span><span class="cp">}}</span><span class="s">&quot;,</span> <span class="err">data.pages[i].title).replace(&quot;</span><span class="cp">{{</span><span class="nv">url</span><span class="cp">}}</span><span class="err">&quot;,</span> <span class="err">data.pages[i].url)</span>
                                <span class="err">$(&quot;#search_result&quot;).append(result_html);</span>
                                <span class="na">found_something=</span><span class="s">true;</span>
                        <span class="err">}</span>
                <span class="err">}</span>
                <span class="err">if(!found_something)</span>
                <span class="err">{</span>
                        <span class="err">$(&quot;#search_result&quot;).append(&quot;&lt;h2</span><span class="nt">&gt;</span>抱歉! 没有找到任何匹配的文章哦。。。<span class="nt">&lt;/h2&gt;</span>&quot;);
                }
          }
        });
}
<span class="nt">&lt;/script&gt;</span>
</pre></div>


<h1>其他</h1>
<p>可以根据添加评论系统，第三方图片接入等等。<br />
ps:关于自带的disqus代码可能不是最新的。需要自己更新下，修改下theme主题插件的相关模板。<br />
试用了uyan（友言）和disqus，发现ab测试下，uyan快100毫秒。不过发现了一个虫（删掉文章后，相关文章链接仍然被收藏并显示出来了），最后还是选择了disqus。</p>
            </div>
            <!-- /.entry-content -->
    <hr/>
    <section class="comments" id="comments">
        <h2>Comments</h2>
        <div id="disqus_thread"></div>
        <script>
            (function() {  // DON'T EDIT BELOW THIS LINE
                var d = document, s = d.createElement('script');
                
                s.src = '//tommyu.disqus.com/embed.js';
                
                s.setAttribute('data-timestamp', +new Date());
                (d.head || d.body).appendChild(s);
            })();
        </script>
        <noscript>Please enable JavaScript to view the 
            <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a>
        </noscript>
    </section>

        </article>
    </section>

        </div>
        <div class="col-sm-3" id="sidebar">
            <aside>

<section class="well well-sm">
    <ul class="list-group list-group-flush">



            <li class="list-group-item"><a href="http://tommyu.github.io/"><h4><i class="fa fa-tags fa-lg"></i><span class="icon-label">Tags</span></h4></a>
                <ul class="list-group " id="tags">
                </ul>
            </li>
    </ul>
</section>
            </aside>
        </div>
    </div>
</div>
<footer>
   <div class="container">
      <hr>
      <div class="row">
         <div class="col-xs-10">&copy; 2016 Tommy
            &middot; Powered by <a href="https://github.com/DandyDev/pelican-bootstrap3" target="_blank">pelican-bootstrap3</a>,
            <a href="http://docs.getpelican.com/" target="_blank">Pelican</a>,
            <a href="http://getbootstrap.com" target="_blank">Bootstrap</a>         </div>
         <div class="col-xs-2"><p class="pull-right"><i class="fa fa-arrow-up"></i> <a href="#">Back to top</a></p></div>
      </div>
   </div>
</footer>
<script src="http://tommyu.github.io/theme/js/jquery.min.js"></script>

<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="http://tommyu.github.io/theme/js/bootstrap.min.js"></script>

<!-- Enable responsive features in IE8 with Respond.js (https://github.com/scottjehl/Respond) -->
<script src="http://tommyu.github.io/theme/js/respond.min.js"></script>

    <!-- Disqus -->
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'tommyu'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function () {
            var s = document.createElement('script');
            s.async = true;
            s.type = 'text/javascript';
            s.src = '//' + disqus_shortname + '.disqus.com/count.js';
            (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
        }());
    </script>
    <!-- End Disqus Code -->


</body>
</html>